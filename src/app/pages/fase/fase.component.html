<div class="fase-card">

  <!-- ===================== CABECERA ===================== -->
  <div class="fase-header">
    <app-progreso-radial class="fase-progreso" [porcentaje]="fase.progreso">
    </app-progreso-radial>

    <div class="fase-titulo">
      <img class="fase-imagen" [src]="getImagenFase(fase.nombre)" [alt]="fase.nombre" />

      <div class="fase-texto">
        <h2 class="fase-nombre">{{ fase.nombre }}</h2>
        <p class="subtitulo">
          <i class="fa-solid fa-clock"></i>
          Seguimiento: {{ fase.dias }} días
        </p>
      </div>
    </div>
  </div>

  <!-- ===================== ACTIVIDADES ===================== -->
  <div class="actividades">

    <div class="actividad" *ngFor="let actividad of fase.actividades">

      <!-- HEADER -->
      <div class="actividad-header">

        <!-- INPUT SOLO SI ES NUEVA -->
        <input *ngIf="actividad.esNueva" #inputNombre type="text" class="input-nombre" [(ngModel)]="actividad.nombre"
          placeholder="Nombre de la actividad" (keydown.enter)="confirmarNombreActividad(actividad)"
          (blur)="confirmarNombreActividad(actividad)" />


        <!-- TEXTO NORMAL -->
        <span *ngIf="!actividad.esNueva" class="actividad-nombre">
          {{ actividad.nombre }}
        </span>

        <button class="eliminar" type="button" title="Eliminar actividad" (click)="eliminarActividad(actividad.id)">
          <i class="fa-solid fa-xmark"></i>
        </button>

      </div>

      <!-- BODY -->
      <div class="actividad-body">

        <!-- CONTROLES -->
        <div class="actividad-controls">

          <label class="switch">
            <input type="checkbox" [(ngModel)]="actividad.activa" (change)="actualizarActividad()" />
            <span class="slider"></span>
          </label>

          <label class="check-realizada">
            <input type="checkbox" [disabled]="!actividad.activa" [(ngModel)]="actividad.completada"
              (change)="actualizarActividad()" />
          </label>

          <span *ngIf="actividad.tipoCosto" class="tipo-costo" [ngClass]="actividad.tipoCosto === 'CF' ? 'cf' : 'cv'">
            {{ actividad.tipoCosto }}
          </span>

          <span class="porcentaje">
            {{ actividad.porcentaje }}%
          </span>
        </div>

        <!-- COSTO -->
        <div class="actividad-costo">
          <div class="costo-input">
            <input type="number" class="input-costo" [(ngModel)]="actividad.costo" [disabled]="!actividad.activa"
              (change)="actualizarActividad()" />
            <span class="unidad">$</span>
          </div>

          <small class="costo-total" *ngIf="actividad.activa">
            Total ({{ hectareas }} ha):
            <strong>
              ${{ actividad.costoTotal | number:'1.2-2' }}
            </strong>
          </small>
        </div>

      </div>
    </div>
  </div>

  <!-- ===================== TOTALES ===================== -->
  <div class="totales">
    <div class="costo-fase">
      Costo total {{ fase.nombre }} por 1 ha:
      <strong>${{ fase.costoTotal | number:'1.2-2' }}</strong>
    </div>

    <div class="costo-fase-extra">
      Total para {{ hectareas }} ha:
      <strong>${{ fase.costoTotalHectareas | number:'1.2-2' }}</strong>
    </div>
  </div>

  <!-- ===================== BOTÓN ===================== -->
  <button class="btn-agregar" type="button" (click)="agregarActividad()">
    <i class="fa-solid fa-plus"></i>
    Nueva actividad
  </button>

</div>
